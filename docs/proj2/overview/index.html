

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="../../assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="../../assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  

    .site-nav > ul.nav-list:first-child > li > a,
    
    .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(4)) > a,
    .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a {
      background-image: none;
    }

    .site-nav > ul.nav-list:not(:first-child) a,
    .site-nav li.external a {
      background-image: none;
    }

    .site-nav > ul.nav-list:first-child > li:nth-child(7) > ul > li:nth-child(4) > a {
      font-weight: 600;
      text-decoration: none;
    }.site-nav > ul.nav-list:first-child > li:nth-child(7) > button svg,
    .site-nav > ul.nav-list:first-child > li:nth-child(7) > ul > li:nth-child(4) > button svg {
      transform: rotate(-90deg);
    }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(7) > ul.nav-list,
    .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(7) > ul.nav-list > li.nav-list-item:nth-child(4) > ul.nav-list {
      display: block;
    }
  </style>

  

  
    <script src="../../assets/js/vendor/lunr.min.js"></script>
  

  <script src="../../assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="icon" href="../../favicon.ico" type="image/x-icon">



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Design Overview | CS 161 Fall 2025</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Design Overview" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Computer Security at UC Berkeley" />
<meta property="og:description" content="Computer Security at UC Berkeley" />
<link rel="canonical" href="index.html" />
<meta property="og:url" content="https://fa25.cs161.org/proj2/overview/" />
<meta property="og:site_name" content="CS 161 Fall 2025" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Design Overview" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Computer Security at UC Berkeley","headline":"Design Overview","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://fa25.cs161.org/"}},"url":"https://fa25.cs161.org/proj2/overview/"}</script>
<!-- End Jekyll SEO tag -->


  <link
  rel="preload"
  href="https://fa25.cs161.org/assets/css/just-the-docs-dark.css"
  as="style"
>

<!-- Intentionally duplicates the default theme stylesheet so there's a fallback when changing themes -->
<link
  id="jtdThemeCSS"
  rel="stylesheet"
  href="../../assets/css/just-the-docs-default.css"
>

<script>
  /* Script to enable persistent dark mode. */

  jtd.getTheme = function () {
    var cssFileHref = (
      document.getElementById('jtdThemeCSS') || document.querySelector('[rel="stylesheet"]')
    ).getAttribute('href');
    return cssFileHref.substring(cssFileHref.lastIndexOf('-') + 1, cssFileHref.length - 4);
  };

  jtd.setTheme = function (theme) {
    var cssFile = document.getElementById('jtdThemeCSS') || document.querySelector('[rel="stylesheet"]');
    cssFile.setAttribute('href', cssFile.getAttribute('href').replace(jtd.getTheme(), theme));
  };

  let toggleDark = () => {
    let setDark = jtd.getTheme() !== 'dark';
    document.documentElement.setAttribute('data-theme', setDark ? 'dark' : 'default');
    document.documentElement.setAttribute('data-theme', setDark ? 'dark' : 'default');
    jtd.setTheme(setDark ? 'dark' : 'default');
    localStorage.setItem('darkMode', String(setDark));

    if (typeof calendar !== 'undefined') {
      calendar.setColorScheme(setDark ? 'dark' : 'light');
    }
  };

  if (localStorage.getItem('darkMode') === 'true') {
    toggleDark();
  }
</script>

<!-- Script for LaTeX rendering. -->
<link
  rel="stylesheet"
  href="../../assets/katex/katex.min.css"
>
<script defer src="../../assets/katex/katex.min.js"></script>
<script>
  function renderKaTeX() {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false },
        { left: '\\[', right: '\\]', display: true },
      ],
    });
  }
</script>
<script
  defer
  src="../../assets/katex/contrib/auto-render.min.js"
  onload="renderKaTeX();"
></script>


</head>

<body>
  <a class="skip-to-main" href="index.html#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="https://fa25.cs161.org/" class="site-title lh-tight">


  CS 161 Fall 2025

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><a href="https://fa25.cs161.org/exam/" class="nav-list-link">Exam Logistics</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/calendar/" class="nav-list-link">Calendar</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/policies/" class="nav-list-link">Policies</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Resources category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="https://fa25.cs161.org/resources/" class="nav-list-link">Resources</a><ul class="nav-list"><li class="nav-list-item"><a href="https://fa25.cs161.org/resources/faqs/" class="nav-list-link">Spring 2026 FAQs</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/resources/instructional-machine/" class="nav-list-link">Instructional Machine Setup</a></li></ul></li><li class="nav-list-item"><a href="https://fa25.cs161.org/staff/" class="nav-list-link">Staff</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Project 1 category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="https://fa25.cs161.org/proj1/" class="nav-list-link">Project 1</a><ul class="nav-list"><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/getting-started/" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/customizing/" class="nav-list-link">Customizing</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/q1/" class="nav-list-link">Question 1: Remus</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/q2/" class="nav-list-link">Question 2: Spica</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/q3/" class="nav-list-link">Question 3: Polaris</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/q4/" class="nav-list-link">Question 4: Vega</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/q5/" class="nav-list-link">Question 5: Deneb</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/q6/" class="nav-list-link">Question 6: Antares</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/q7/" class="nav-list-link">Question 7: Rigel</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/deliverables/" class="nav-list-link">Deliverables</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj1/vm-debugging/" class="nav-list-link">Troubleshooting</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Project 2 category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="../index.html" class="nav-list-link">Project 2</a><ul class="nav-list"><li class="nav-list-item"><a href="../story/index.html" class="nav-list-link">Story</a></li><li class="nav-list-item"><a href="../policies.html" class="nav-list-link">Project 2 Policies and Deliverables</a></li><li class="nav-list-item"><a href="../getting-started.html" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="index.html" class="nav-list-link">Design Overview</a></li><li class="nav-list-item"><a href="../library.html" class="nav-list-link">Library Functions</a></li><li class="nav-list-item"><a href="../userauth/index.html" class="nav-list-link">Users And User Authentication</a></li><li class="nav-list-item"><a href="../files/index.html" class="nav-list-link">File Operations</a></li><li class="nav-list-item"><a href="../sharing/index.html" class="nav-list-link">Sharing and Revocation</a></li><li class="nav-list-item"><a href="../troubleshooting.html" class="nav-list-link">Debugging and Errors</a></li><li class="nav-list-item"><a href="../advice/index.html" class="nav-list-link">Advice and Tips</a></li><li class="nav-list-item"><a href="../appendix/index.html" class="nav-list-link">Appendix</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Project 3 category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="https://fa25.cs161.org/proj3/" class="nav-list-link">Project 3</a><ul class="nav-list"><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/story/" class="nav-list-link">Story</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/getting-started/" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/tips/" class="nav-list-link">General Tips</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag1/" class="nav-list-link">Flag 1: dev</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag2/" class="nav-list-link">Flag 2: ip.txt</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag3/" class="nav-list-link">Flag 3: shomil</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag4/" class="nav-list-link">Flag 4: nicholas</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag5/" class="nav-list-link">Flag 5: cs161</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag6/" class="nav-list-link">Flag 6: delete</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag7/" class="nav-list-link">Flag 7: admin</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/flag8/" class="nav-list-link">Flag 8: config</a></li><li class="nav-list-item"><a href="https://fa25.cs161.org/proj3/deliverables/" class="nav-list-link">Deliverables</a></li></ul></li></ul>
  
</nav>




  
  
    <div class="site-footer">
	Report an <a href="https://dap.berkeley.edu/get-help/report-web-accessibility-issue">accessibility issue</a>.

	<br><br>

	This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
</div>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search CS 161 Fall 2025" aria-label="Search CS 161 Fall 2025" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="index.html#" class="site-button"
          
        >
          Dark Mode
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://textbook.cs161.org" class="site-button"
          
        >
          Textbook
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://edstem.org/us/courses/83260" class="site-button"
          
        >
          Ed
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://oh.cs161.org" class="site-button"
          
        >
          OH Queue
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://forms.gle/uaFdyWWqnPkW9Uhg6" class="site-button"
          
        >
          Extensions
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://forms.gle/bW9nen9oHGNUzWo69" class="site-button"
          
        >
          Anonymous Feedback
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://calendar.app.google/9quTrjViGAGPG47Z8" class="site-button"
          
        >
          Student Support
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
    <li class="breadcrumb-nav-list-item"><a href="../index.html">Project 2</a></li>
    <li class="breadcrumb-nav-list-item"><span>Design Overview</span></li>
  </ol>
</nav>


      <div id="main-content" class="main-content">
        <main>
          
            <div class="content-container">
    <nav class="content-nav nav-list js-toc" aria-label="In-page navigation">
      <ul class="nav-list"><li class="nav-list-item"><a href="index.html#functionality-overview" class="nav-list-link">Functionality Overview</a></li><li class="nav-list-item"><a href="index.html#threat-model" class="nav-list-link">Threat Model</a></li><li class="nav-list-item"><a href="index.html#the-user-class" class="nav-list-link">The User Class</a></li><li class="nav-list-item"><a href="index.html#atomic-operations" class="nav-list-link">Atomic Operations</a></li><li class="nav-list-item"><a href="index.html#stateless-design" class="nav-list-link">Stateless Design</a></li><li class="nav-list-item"><a href="index.html#keystore" class="nav-list-link">Keystore</a></li><li class="nav-list-item"><a href="index.html#datastore" class="nav-list-link">Datastore</a></li><li class="nav-list-item"><a href="index.html#threat-model-datastore-adversary" class="nav-list-link">Threat Model: Datastore Adversary</a></li><li class="nav-list-item"><a href="index.html#error-handling" class="nav-list-link">Error Handling</a></li><li class="nav-list-item"><a href="index.html#terminology-note-pointers" class="nav-list-link">Terminology Note: Pointers</a></li></ul>
    </nav>
  <div class="content">
<h1 id="design-overview">
  
  
    <a href="index.html#design-overview" class="anchor-heading" aria-labelledby="design-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design Overview
  
  
</h1>
    

<p>In this section, we give a high-level overview of what you’ll be designing. We also describe general requirements that apply to the entire design. (Requirements specific to individual functions are described later.)</p>
<h2 id="functionality-overview">
  
  
    <a href="index.html#functionality-overview" class="anchor-heading" aria-labelledby="functionality-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Functionality Overview
  
  
</h2>
    

<p>In this project, you will be designing a system that allows users to securely store and share files in the presence of attackers. In particular, you will be implementing the following 8 functions:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">InitUser</code>: Given a new username and password, create a new user.</li>
  <li><code class="language-plaintext highlighter-rouge">GetUser</code>: Given a username and password, let the user log in if the password is correct.</li>
  <li><code class="language-plaintext highlighter-rouge">User.StoreFile</code>: For a logged-in user, given a filename and file contents, create a new file or overwrite an existing file.</li>
  <li><code class="language-plaintext highlighter-rouge">User.LoadFile</code>: For a logged-in user, given a filename, fetch the corresponding file contents.</li>
  <li><code class="language-plaintext highlighter-rouge">User.AppendToFile</code>: For a logged-in user, given a filename and additional file contents, append the additional file contents at the end of the existing file contents, while following some efficiency requirements.</li>
  <li><code class="language-plaintext highlighter-rouge">User.CreateInvitation</code>: For a logged-in user, given a filename and target user, generate an invitation UUID that the target user can use to gain access to the file.</li>
  <li><code class="language-plaintext highlighter-rouge">User.AcceptInvitation</code>: For a logged-in user, given an invitation UUID, obtain access to a file shared by a different user. Allow the recipient user to access the file using a (possibly different) filename of their own choosing.</li>
  <li><code class="language-plaintext highlighter-rouge">User.RevokeAccess</code>: For a logged-in user, given a filename and target user, revoke the target user’s access so that they are no longer able to access a shared file.</li>
</ul>

<p>More details about these functions later in the spec. You don’t need to implement a frontend for this project; all users will interact with your system by running a copy of your code and calling these 8 functions.</p>
<h2 id="threat-model">
  
  
    <a href="index.html#threat-model" class="anchor-heading" aria-labelledby="threat-model"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Threat Model
  
  
</h2>
    

<p>You could say that the high-level goal is to design a system that users can use to store their data on an untrusted server.  Other users should not be able to access their data, and even if the server is malicious, it should not be able to access their data.  You can assume that legitimate users will use your code, but there are malicious actors in our threat model that can use any client code they wanted, and the system will have to remain secure despite that fact. The details of these attackers are detailed later, in the sections <a href="index.html#threat-model-datastore-adversary">Threat Model: Datastore Adversary</a> and <a href="../sharing/index.html#design-requirements-revoked-user-adversary">Design Requirements: Revoked User Adversary</a>.</p>
<h2 id="the-user-class">
  
  
    <a href="index.html#the-user-class" class="anchor-heading" aria-labelledby="the-user-class"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The User Class
  
  
</h2>
    

<p>You will implement the 8 functions above as part of the <code class="language-plaintext highlighter-rouge">User</code> class. The <code class="language-plaintext highlighter-rouge">User</code> class has:</p>
<ul>
  <li>Two constructors, <code class="language-plaintext highlighter-rouge">InitUser</code> and <code class="language-plaintext highlighter-rouge">GetUser</code>, which create and return new <code class="language-plaintext highlighter-rouge">User</code> objects. A <code class="language-plaintext highlighter-rouge">User</code> object is represented as a reference to a <code class="language-plaintext highlighter-rouge">User</code> struct containing instance variables. A constructor is called every time a user logs in.</li>
  <li>Six instance methods (the other functions listed above), which can be called on a <code class="language-plaintext highlighter-rouge">User</code> object. The user calls these functions to perform file and sharing operations.</li>
  <li>Instance variables, specific to each <code class="language-plaintext highlighter-rouge">User</code> object, which can be used to store information about each user. The instance variables are stored in the <code class="language-plaintext highlighter-rouge">User</code> struct returned by a constructor, and the instance variables are accessible to all the instance methods.</li>
</ul>

<p>If a user calls a constructor multiple times, there will be multiple <code class="language-plaintext highlighter-rouge">User</code> objects that all represent the same user. You will need to make sure that these <code class="language-plaintext highlighter-rouge">User</code> objects do not use outdated data (more details later).</p>
<h2 id="atomic-operations">
  
  
    <a href="index.html#atomic-operations" class="anchor-heading" aria-labelledby="atomic-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Atomic Operations
  
  
</h2>
    

<p>You do not need to worry about parallel function calls or any concurrency issues for this project. You can assume that at any given time, only one function is being executed. Another function call will only begin after the current function call has completed.</p>

<p>You can also assume that we will not quit the program in the middle of a function call. As long as your code doesn’t crash, every function call will run to completion.</p>

<p>You can also assume that malicious action will only happen in between function calls, and will not happen in the middle of a function call.</p>
<h2 id="stateless-design">
  
  
    <a href="index.html#stateless-design" class="anchor-heading" aria-labelledby="stateless-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stateless Design
  
  
</h2>
    

<p>Multiple users may use the system by calling your functions. Each user may have multiple devices (e.g. Alice may have a laptop and a phone). Every device runs a separate identical copy of your code.</p>

<p>As a consequence of this, your code cannot have global variables (except for basic constants). This is because these global variables will not be synced across devices.</p>

<p>If a user’s copy of the code crashes after running a function, or if the user quits running the code, they will lose all data stored in the code’s local memory (e.g. global variables, instance variables in <code class="language-plaintext highlighter-rouge">User</code> objects, etc).  Therefore, you cannot rely on storing persistent information in the code’s local memory.</p>

<p>All devices running your code are able to send and receive data from two shared remote databases called Datastore and Keystore (more details later). All persistent data must be stored on Datastore or Keystore.</p>
<h2 id="keystore">
  
  
    <a href="index.html#keystore" class="anchor-heading" aria-labelledby="keystore"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Keystore
  
  
</h2>
    

<p>Keystore is a remote database where you can store <strong>public</strong> keys.</p>

<p>Keystore is organized as a set of name-value pairs, similar to a dictionary in Python or a HashMap in Java. (Note: Sometimes these are called key-value pairs, but we will call them name-value pairs to avoid confusion with cryptographic keys.)</p>

<p>The name in each name-value pair must be string. The value in each name-value pair must be a public key (either a public encryption key of type <code class="language-plaintext highlighter-rouge">PKEEncKey</code>, or a public verification key of type <code class="language-plaintext highlighter-rouge">DSVerifyKey</code>).</p>

<p>Go’s type-checking will enforce that all values stored are public keys. <strong>You cannot store salts, hashes, structs, files, or any other data that is not a public key on Keystore.</strong> If you want to store something that is not a public key, you must store it in Datastore, not Keystore.</p>

<p>Each user may only store a small, constant number of public keys on Keystore. In other words, the total number of keys on Keystore should only scale with the number of users. In other words, you cannot create a new public key per file, per share, etc.</p>

<p>Once a name-value pair is written to Keystore, it cannot be modified or deleted. Everybody (including attackers) can read all values, but cannot modify any values, on Keystore.</p>

<p>Keystore is already implemented for you. You can write new name-value pairs using <code class="language-plaintext highlighter-rouge">KeystoreSet</code>, and you can read the value corresponding to a name using <code class="language-plaintext highlighter-rouge">KeystoreGet</code> (more details later).</p>
<h2 id="datastore">
  
  
    <a href="index.html#datastore" class="anchor-heading" aria-labelledby="datastore"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Datastore
  
  
</h2>
    

<p>Datastore is an insecure remote database where you can store data. The Datastore Adversary is an attacker who can read and modify any data on Datastore (more details later). Therefore, you must protect the confidentiality and integrity of any sensitive data you store on Datastore.</p>

<p>Datastore is organized as a set of name-value pairs, just like Keystore. The name in each name-value pair must be a UUID, a unique 16-byte string (more details later). The value in each name-value pair can be any byte array of data.</p>

<p>Given a specific name (UUID), there is one and only one corresponding value, which can be read and modified by anybody who knows the name (UUID).</p>

<p>Datastore is already implemented for you. You can write new name-value pairs using <code class="language-plaintext highlighter-rouge">DatastoreSet</code>, you can read the value corresponding to a name using <code class="language-plaintext highlighter-rouge">DatastoreGet</code>, and you can delete a name-value pair using <code class="language-plaintext highlighter-rouge">DatastoreDelete</code> (more details later).</p>

<blockquote class="QUESTION">
  <p><strong>Data structures</strong>: What data structures are you going to use to organize data on Datastore?</p>

  <p>List any struct definitions that you plan on using, along with the fields that each struct will contain.</p>

  <p>We recommend starting with a few core data structures (e.g. <code class="language-plaintext highlighter-rouge">struct user</code>, <code class="language-plaintext highlighter-rouge">struct file</code>, <code class="language-plaintext highlighter-rouge">struct invitation</code>, etc.) and adding additional fields and structs as you need them.</p>

  <p>For every subsequent design question, think about what data structures are used, and what is being stored and where. How will you generate the UUID that you are storing the information at? How will you ensure confidentiality and integrity? Which keys will you use, and how are you generating and accessing them?</p>
</blockquote>
<h2 id="threat-model-datastore-adversary">
  
  
    <a href="index.html#threat-model-datastore-adversary" class="anchor-heading" aria-labelledby="threat-model-datastore-adversary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Threat Model: Datastore Adversary
  
  
</h2>
    

<p>The Datastore Adversary is an attacker who can read and modify all name-value pairs, and add new name-value pairs, on Datastore. They can modify Datastore at any time (but not in the middle of another function executing).</p>

<p>The Datastore Adversary has a global view of Datastore; in other words, they can list out all name-value pairs that currently exist on Datastore.</p>

<p>The Datastore Adversary can take snapshots of Datastore at any time. For example, they could write down all existing name-value pairs before a user calls <code class="language-plaintext highlighter-rouge">StoreFile</code>. Then, they could write down all existing name-value pairs after a user calls <code class="language-plaintext highlighter-rouge">StoreFile</code> and compare the difference to see which name-value pairs changed as a result of the function call.</p>

<p>The Datastore Adversary can see when a user calls a function (e.g. if a user calls <code class="language-plaintext highlighter-rouge">StoreFile</code>, they know which user called it and when).</p>

<p>The Datastore Adversary can view and record the content and metadata of all requests to the <a href="../library.html#datastore">Datastore API</a>. This means that they will know what the inputs and outputs to the functions are.</p>

<p>The Datastore Adversary is not a user in the system, and will not collude with other users. However, the Datastore Adversary has a copy of your source code (Kerckhoff’s principle), and they could execute lines of your code on their own in order to modify Datastore in a way that mimics your code’s behavior.</p>

<p>The Datastore adversary will not perform any rollback attacks: Given a specific UUID, they will not read the value at that UUID, and then later replace the value at that UUID with the older value they read. (Deleting a value at a UUID is not a rollback attack.)</p>

<p>They will also not perform any rollback attacks on multiple UUIDs. For example, they will not revert the entire contents of Datastore to some previous snapshot of Datastore they took.</p>

<p>There is one other adversary besides the Datastore Adversary, called the Revoked User Adversary. The two adversaries do not collude. This additional adversary will be described later.</p>

<blockquote class="QUESTION">
  <p><strong>Datastore Adversary</strong>: How should you store information in the Datastore?</p>

  <p>You might be tempted to follow a design where you hash the password, store the hashed password on the Datastore, and then GetUser will use that to check whether the user’s password is correct, and if so, allow the user to access their data.  This approach isn’t going to work.  Exercise: What’s wrong with this approach?  Where will you store the user’s data?  If it is encrypted, where will the key be stored? Can you ensure that if the Datastore Adversary tampers with the stored values, that you can detect this?</p>
</blockquote>
<h2 id="error-handling">
  
  
    <a href="index.html#error-handling" class="anchor-heading" aria-labelledby="error-handling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Handling
  
  
</h2>
    

<p>All 8 functions have <code class="language-plaintext highlighter-rouge">err</code> as one of their return values. If the function successfully executes without an error, you should return nil (the null value in Go) for the <code class="language-plaintext highlighter-rouge">err</code> return value.</p>

<p>If a function is unable to execute correctly, all you need to do is return an error that is not nil. The function could fail due to functionality issues (e.g. a user supplies an invalid argument), or security issues (e.g. an attacker has tampered with data that prevents your function from executing correctly). The error message can be anything you want (as long as the error is not nil), though we recommend using informative error messages for easier debugging.</p>

<p>You only need to detect when errors occur in this project; you do not need to recover from errors. For example, suppose an attacker has tampered with a file stored in Datastore, and the user calls <code class="language-plaintext highlighter-rouge">LoadFile</code> to try and read the file contents. Your code only needs to detect that tampering has occured and return any non-nil error. You do not need to recover from the error (i.e. you don’t need to try and recover the original file contents).</p>

<p>After an adversary performs malicious action, your function must either return an error, or execute correctly as if the adversary had not performed malicious action.</p>

<p>As soon as a non-nil error is returned, all subsequent function calls can have undefined behavior. Undefined behavior means that your code can do anything (execute without an error, return an error, crash, etc.), as long as you do not violate any security requirements.</p>

<blockquote class="EXAMPLE">
  <p>A user stores two files, FileA.txt and FileB.txt. Your code stores the contents of these files in Datastore. Then, an attacker modifies some values on Datastore, including the contents of FileB.txt.</p>

  <p>If the user tries to load FileB.txt, you should return a non-nil error value to detect that tampering has occurred. You do not need to try and recover the original unmodified contents of FileB.txt.</p>

  <p>If the user instead tries to load FileA.txt, you have two options. If your code can successfully load the original unmodified contents of this file, you can return a nil error. Alternatively, if your code is unable to load the original unmodified contents of this file, you can return a non-nil error.</p>

  <p>If the user’s call to the load function returned a non-nil error, then all subsequent function calls have undefined behavior, as long as you do not violate any security requirements (e.g. subsequent function calls still cannot leak the contents of a confidential file).</p>
</blockquote>

<p>Your code should never <code class="language-plaintext highlighter-rouge">panic</code> (the Go term for crashing the program). You should always return a non-nil error that can be safely processed by other code (e.g. the autograder). If your code panics, then the autograder might crash and be unable to give you a score.</p>
<h2 id="terminology-note-pointers">
  
  
    <a href="index.html#terminology-note-pointers" class="anchor-heading" aria-labelledby="terminology-note-pointers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terminology Note: Pointers
  
  
</h2>
    

<p>In this project, the term “pointer” can refer to two different concepts. In this spec, we will always clarify which concept we’re referring to.</p>

<p>A <em>Go memory pointer</em> is a variable that contains a memory address of some other object in the Go runtime’s local memory. Go memory pointers are similar to pointers in C. In this project, because you cannot store persistent data in the program’s local memory, you should rarely need to use Go memory pointers.</p>

<p>The only scenario where Go memory pointers are required for this project are in the <code class="language-plaintext highlighter-rouge">InitUser</code> and <code class="language-plaintext highlighter-rouge">GetUser</code> constructors. The constructors create a new <code class="language-plaintext highlighter-rouge">User</code> object by creating a new <code class="language-plaintext highlighter-rouge">User</code> struct in local memory, and returning a Go memory pointer that contains the address of this <code class="language-plaintext highlighter-rouge">User</code> struct in local memory.</p>

<blockquote class="EXAMPLE">
  <p>Here’s a code snippet showing how the User class works.</p>

  <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">alice</span> <span class="o">*</span><span class="n">client</span><span class="o">.</span><span class="n">User</span>
<span class="k">var</span> <span class="n">err</span> <span class="kt">error</span>
<span class="n">alice</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">InitUser</span><span class="p">(</span><span class="s">"Alice"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">)</span>
<span class="n">alice</span><span class="o">.</span><span class="n">StoreFile</span><span class="p">(</span><span class="s">"FileA.txt"</span><span class="p">,</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"Some text."</span><span class="p">))</span>
</code></pre></div>  </div>

  <p>The variable <code class="language-plaintext highlighter-rouge">alice</code> is a Go memory pointer, containing the address of a User struct that was created by the <code class="language-plaintext highlighter-rouge">InitUser</code> constructor.</p>

  <p><code class="language-plaintext highlighter-rouge">StoreFile</code> is an instance method, so you cannot call it by itself. Instead, you need to call it on an existing User object (<code class="language-plaintext highlighter-rouge">alice</code> in this example). This function call has access to all the instance variables in the User struct that <code class="language-plaintext highlighter-rouge">alice</code> points to.</p>
</blockquote>

<p>Recall that in Datastore, you can store any data you want at a given UUID. If the data you choose to store is another UUID, then you’ve created a <em>Datastore pointer</em>. If you fetch the data at the given UUID, you will receive another UUID which references another location in Datastore.</p>

  </div>
</div>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    









<script>
  (function () {
    var navList = document.querySelector('.aux-nav-list');
    if (!navList || !navList.firstElementChild) return;
    var darkToggle = navList.firstElementChild;
    darkToggle.addEventListener('click', (e) => {
      e.preventDefault();
      toggleDark();
    });
  })();
</script>

<script src="../../assets/js/tocbot.min.js"></script>
<script>
  // Tries to mirror the HTML TOC
  tocbot.init({
    tocSelector: '.js-toc',
    contentSelector: '.content',
    headingSelector: 'h2,h3,h4,h5,h6',
    ignoreSelector: '.no_toc',
    hasInnerContainers: true,
    linkClass: 'nav-list-link',
    activeLinkClass: 'active',
    listClass: 'nav-list',
    listItemClass: 'nav-list-item',
    activeListItemClass: 'active',
    collapseDepth: 3,
    scrollSmooth: false,
  });
</script>


    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
</body>
</html>

